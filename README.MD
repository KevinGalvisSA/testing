# ðŸ“š DocumentaciÃ³n del Proyecto Backend - GestiÃ³n de Usuarios y AutenticaciÃ³n

---

## ðŸ“Œ TecnologÃ­as utilizadas:

* **Node.js** (con CommonJS)
* **TypeScript**
* **Express**
* **TypeORM**
* **PostgreSQL**
* **bcryptjs** (para hashing de contraseÃ±as)
* **jsonwebtoken** (para autenticaciÃ³n vÃ­a JWT)
* **dotenv** (para variables de entorno)

---

## ðŸ“Œ Arquitectura: Hexagonal (Ports and Adapters)

El proyecto estÃ¡ estructurado siguiendo la arquitectura **Hexagonal (o Clean Architecture)**.

### Principales capas:

| Capa                | DescripciÃ³n                                              |
| ------------------- | -------------------------------------------------------- |
| **Dominio**         | Entidades y contratos (interfaces de repositorios)       |
| **AplicaciÃ³n**      | Casos de uso (lÃ³gica de negocio)                         |
| **Infraestructura** | Adaptadores concretos: Express (HTTP), TypeORM (DB), etc |
| **ConfiguraciÃ³n**   | ConexiÃ³n a base de datos, variables de entorno           |

---

## ðŸ“Œ Estructura de Carpetas:

```
backend/
â”œâ”€â”€ .env
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts
â”‚   â”‚   â”‚   â””â”€â”€ Account.ts
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚       â”œâ”€â”€ UserRepository.ts
â”‚   â”‚       â””â”€â”€ AccountRepository.ts
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â””â”€â”€ usecases/
â”‚   â”‚       â”œâ”€â”€ CreateUser.ts
â”‚   â”‚       â”œâ”€â”€ CreateAccount.ts
â”‚   â”‚       â””â”€â”€ LoginAccount.ts
â”‚   â””â”€â”€ infrastructure/
â”‚       â”œâ”€â”€ controllers/
â”‚       â”‚   â”œâ”€â”€ UserController.ts
â”‚       â”‚   â””â”€â”€ AuthController.ts
â”‚       â””â”€â”€ persistence/
â”‚           â”œâ”€â”€ UserRepositoryImpl.ts
â”‚           â””â”€â”€ AccountRepositoryImpl.ts
â”‚       â””â”€â”€ data-source.ts
â””â”€â”€ src/index.ts
```

---

## ðŸ“Œ Variables de Entorno (.env):

```
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD="mi_password"
DB_NAME=mi_base_de_datos
JWT_SECRET=mi_secreto_super_seguro
```

---

## ðŸ“Œ Entidades (Dominio):

### User.ts (Perfil o informaciÃ³n de usuario)

```ts
@Entity()
export class User {
    @PrimaryGeneratedColumn()
    id!: number;

    @Column()
    name!: string;

    @Column()
    email!: string;
}
```

---

### Account.ts (Cuenta para autenticaciÃ³n)

```ts
@Entity()
export class Account {
    @PrimaryGeneratedColumn()
    id!: number;

    @Column({ unique: true })
    email!: string;

    @Column()
    password!: string;
}
```

---

## ðŸ“Œ Casos de uso (AplicaciÃ³n):

* **CreateUser.ts** â†’ Crear perfiles de usuario
* **CreateAccount.ts** â†’ Registrar cuentas para login
* **LoginAccount.ts** â†’ Validar email + password, devolver JWT

---

## ðŸ“Œ Repositorios (Dominio + Infraestructura):

* **UserRepository.ts** â†’ Contrato para gestiÃ³n de usuarios
* **AccountRepository.ts** â†’ Contrato para gestiÃ³n de cuentas

Implementaciones:

* **UserRepositoryImpl.ts**
* **AccountRepositoryImpl.ts**

---

## ðŸ“Œ Controladores (Infraestructura â†’ Express):

### `/users`

* POST `/users` â†’ Crear perfil de usuario

### `/auth`

* POST `/auth/register` â†’ Crear cuenta de acceso (con email + password)
* POST `/auth/login` â†’ Login y obtener JWT

---

## ðŸ“Œ Flujo de Registro de Cuentas:

1. **POST `/auth/register`**
   Body JSON:

```json
{
    "name": "Leonardo",
    "email": "test@example.com",
    "password": "123456"
}
```

---

## ðŸ“Œ Flujo de Login:

1. **POST `/auth/login`**
   Body JSON:

```json
{
    "name": "Leonardo",
    "email": "test@example.com",
    "password": "123456"
}
```

Respuesta:

```json
{
    "token": "JWT_GENERADO_AQUI",
    "accountId": 1
}
```

---

## ðŸ“Œ Seguridad:

* Las contraseÃ±as estÃ¡n **hasheadas con bcrypt** antes de almacenarse.
* Los tokens JWT tienen **expiraciÃ³n de 1 hora**.

---

## ðŸ“Œ InicializaciÃ³n del Proyecto:

1. Instala dependencias:

```bash
cd backend
npm install
```

2. Crea tu base de datos PostgreSQL con el nombre que pusiste en `.env`.

3. Ejecuta el backend en modo desarrollo:

```bash
npm run dev
```

TypeORM crearÃ¡ las tablas automÃ¡ticamente por el parÃ¡metro:

```ts
synchronize: true
```

*(Solo en desarrollo, no en producciÃ³n).*

---

## ðŸ“Œ Mejoras futuras planteadas:

* Agregar roles y permisos para un control de acceso.
* Crear middlewares de autenticaciÃ³n (para proteger endpoints).
* Crear pruebas unitarias por capa.
* Separar DTOs o Request Objects.
* Crear migraciones de base de datos.

---

## âœ… Resumen:

Este proyecto sigue **Hexagonal Architecture**, tiene **capas bien separadas**, y ya cubre:
âœ… Persistencia (TypeORM + PostgreSQL)
âœ… CreaciÃ³n de perfiles (User)
âœ… Registro de cuentas (Account)
âœ… Login con generaciÃ³n de JWT
